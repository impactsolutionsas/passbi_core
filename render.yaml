# Render Blueprint pour PassBi Core
# Déploiement automatique : API Go
# NOTE: PostgreSQL géré par Supabase (externe)
# NOTE: Redis géré par Upstash (externe)

services:
  # API PassBi (Application Go)
  - type: web
    name: passbi-api
    runtime: docker
    dockerfilePath: ./Dockerfile
    repo: https://github.com/impactsolutionsas/passbi_core
    branch: main
    envVars:
      # Database (Supabase - External - Connection Pooler)
      - key: DB_HOST
        value: aws-1-eu-north-1.pooler.supabase.com
      - key: DB_PORT
        value: 6543
      - key: DB_NAME
        value: postgres
      - key: DB_USER
        value: postgres.xlvuggzprjjkzolonbuh
      - key: DB_PASSWORD
        value: I9YyF1jg7XBuxRrQ
      - key: DB_SSLMODE
        value: require

      # Redis (Upstash - External)
      - key: REDIS_HOST
        value: literate-oyster-54938.upstash.io
      - key: REDIS_PORT
        value: 6379
      - key: REDIS_PASSWORD
        value: AdaaAAIncDI3MWE3NTIzNGY3ZDA0NjdjYmRhYjZlYzNhYmZjNzQ0MXAyNTQ5Mzg
      - key: REDIS_DB
        value: 0
      - key: REDIS_TLS_ENABLED
        value: "true"

      # API Configuration
      - key: API_PORT
        value: 8080
      - key: API_READ_TIMEOUT
        value: 5s
      - key: API_WRITE_TIMEOUT
        value: 10s

      # Cache Configuration
      - key: CACHE_TTL
        value: 10m
      - key: CACHE_MUTEX_TTL
        value: 5s

      # Routing Configuration
      - key: MAX_WALK_DISTANCE
        value: 500
      - key: WALKING_SPEED
        value: 1.4
      - key: TRANSFER_TIME
        value: 180
      - key: MAX_EXPLORED_NODES
        value: 150000
      - key: ROUTE_TIMEOUT
        value: 30s

    healthCheckPath: /health

# NOTE: Base de données PostgreSQL gérée par Supabase (externe)
# NOTE: Redis géré par Upstash (externe)
# Aucune création de bases de données nécessaire sur Render
